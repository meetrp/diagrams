<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="2487px" preserveAspectRatio="none" style="width:1574px;height:2487px;background:#FFFFFF;" version="1.1" viewBox="0 0 1574 2487" width="1574px" zoomAndPan="magnify"><defs><filter height="300%" id="fm0ptrzyw4b7r" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="873" x="347" y="58.7021">[oauth 2.0] Authorization Code Grant with PKCE flow (app to server)</text><text fill="#000000" font-family="sans-serif" font-size="11" font-style="italic" lengthAdjust="spacing" textLength="290" x="640.5" y="74.1011">User wants to authorize email client to read emails</text><text fill="#000000" font-family="sans-serif" font-size="11" font-style="italic" lengthAdjust="spacing" textLength="266" x="650.5" y="86.9058">from the email servers (i.e., resource servers)</text><rect fill="#EFEFFF" height="2383.6094" style="stroke:#A80036;stroke-width:1.0;" width="469" x="315" y="97.5"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="200" x="447" y="109.5669">Client App &amp; embedded UA</text><rect fill="#FFFFFF" filter="url(#fm0ptrzyw4b7r)" height="101.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="198.5" y="909.2109"/><rect fill="#FFFFFF" filter="url(#fm0ptrzyw4b7r)" height="28" style="stroke:#A80036;stroke-width:1.0;" width="10" x="203.5" y="946.3438"/><rect fill="#FFFFFF" filter="url(#fm0ptrzyw4b7r)" height="2209.1563" style="stroke:#A80036;stroke-width:1.0;" width="10" x="352.5" y="199.3594"/><rect fill="#FFFFFF" filter="url(#fm0ptrzyw4b7r)" height="28" style="stroke:#A80036;stroke-width:1.0;" width="10" x="357.5" y="349.1563"/><rect fill="#FFFFFF" filter="url(#fm0ptrzyw4b7r)" height="28" style="stroke:#A80036;stroke-width:1.0;" width="10" x="357.5" y="436.4219"/><rect fill="#FFFFFF" filter="url(#fm0ptrzyw4b7r)" height="826.25" style="stroke:#A80036;stroke-width:1.0;" width="10" x="726.5" y="628.6172"/><rect fill="#FFFFFF" filter="url(#fm0ptrzyw4b7r)" height="44.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="862" y="228.4922"/><rect fill="#FFFFFF" filter="url(#fm0ptrzyw4b7r)" height="204.9297" style="stroke:#A80036;stroke-width:1.0;" width="10" x="862" y="2174.4531"/><rect fill="#FFFFFF" filter="url(#fm0ptrzyw4b7r)" height="28" style="stroke:#A80036;stroke-width:1.0;" width="10" x="867" y="2315.25"/><rect fill="#FFFFFF" filter="url(#fm0ptrzyw4b7r)" height="101.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1193" y="778.8125"/><rect fill="#FFFFFF" filter="url(#fm0ptrzyw4b7r)" height="28" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1198" y="815.9453"/><rect fill="#FFFFFF" filter="url(#fm0ptrzyw4b7r)" height="280.1953" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1193" y="1085.0078"/><rect fill="#FFFFFF" filter="url(#fm0ptrzyw4b7r)" height="28" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1198" y="1161.4063"/><rect fill="#FFFFFF" filter="url(#fm0ptrzyw4b7r)" height="28" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1198" y="1240.5391"/><rect fill="#FFFFFF" filter="url(#fm0ptrzyw4b7r)" height="469.8594" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1193" y="1630.0625"/><rect fill="#FFFFFF" filter="url(#fm0ptrzyw4b7r)" height="28" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1198" y="1667.1953"/><rect fill="#FFFFFF" filter="url(#fm0ptrzyw4b7r)" height="28" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1198" y="1793.7266"/><rect fill="#FFFFFF" filter="url(#fm0ptrzyw4b7r)" height="28" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1198" y="1896.125"/><rect fill="#FFFFFF" filter="url(#fm0ptrzyw4b7r)" height="28" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1198" y="1975.2578"/><rect fill="#FFFFFF" filter="url(#fm0ptrzyw4b7r)" height="29.1328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1193" y="2248.9844"/><rect fill="#FFFFCC" filter="url(#fm0ptrzyw4b7r)" height="191.6641" style="stroke:#000000;stroke-width:2.0;" width="305.5" x="309" y="287.7578"/><rect fill="#FFFFCC" filter="url(#fm0ptrzyw4b7r)" height="104.3984" style="stroke:#000000;stroke-width:2.0;" width="460.5" x="1096.5" y="1100.0078"/><rect fill="#FFFFCC" filter="url(#fm0ptrzyw4b7r)" height="221.9297" style="stroke:#000000;stroke-width:2.0;" width="418.5" x="1096.5" y="1717.1953"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="203" x2="203" y1="168.2266" y2="2426.5156"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="357" x2="357" y1="168.2266" y2="2426.5156"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="731" x2="731" y1="168.2266" y2="2426.5156"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="867" x2="867" y1="168.2266" y2="2426.5156"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1197.5" x2="1197.5" y1="168.2266" y2="2426.5156"/><rect fill="#FEFECE" filter="url(#fm0ptrzyw4b7r)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="149" x="127" y="116.6328"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="135" x="134" y="136.6279">«Resource Owner»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31" x="186" y="152.9248">User</text><rect fill="#FEFECE" filter="url(#fm0ptrzyw4b7r)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="149" x="127" y="2425.5156"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="135" x="134" y="2445.5107">«Resource Owner»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31" x="186" y="2461.8076">User</text><rect fill="#FFE0E0" filter="url(#fm0ptrzyw4b7r)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="73" x="319" y="116.6328"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="59" x="326" y="136.6279">«Client»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="30" x="340.5" y="152.9248">App</text><rect fill="#FFE0E0" filter="url(#fm0ptrzyw4b7r)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="73" x="319" y="2425.5156"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="59" x="326" y="2445.5107">«Client»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="30" x="340.5" y="2461.8076">App</text><rect fill="#FFE0E0" filter="url(#fm0ptrzyw4b7r)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="93" x="683" y="132.9297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="79" x="690" y="152.9248">User Agent</text><rect fill="#FFE0E0" filter="url(#fm0ptrzyw4b7r)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="93" x="683" y="2425.5156"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="79" x="690" y="2445.5107">User Agent</text><rect fill="#C9FFC9" filter="url(#fm0ptrzyw4b7r)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="150" x="790" y="116.6328"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="136" x="797" y="136.6279">«Resource Server»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="90" x="820" y="152.9248">GMail Server</text><rect fill="#C9FFC9" filter="url(#fm0ptrzyw4b7r)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="150" x="790" y="2425.5156"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="136" x="797" y="2445.5107">«Resource Server»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="90" x="820" y="2461.8076">GMail Server</text><rect fill="#C9FFC9" filter="url(#fm0ptrzyw4b7r)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="179" x="1106.5" y="116.6328"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="164" x="1114" y="136.6279">«Authorization Server»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="165" x="1113.5" y="152.9248">Google Account Server</text><rect fill="#C9FFC9" filter="url(#fm0ptrzyw4b7r)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="179" x="1106.5" y="2425.5156"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="164" x="1114" y="2445.5107">«Authorization Server»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="165" x="1113.5" y="2461.8076">Google Account Server</text><rect fill="#FFFFFF" filter="url(#fm0ptrzyw4b7r)" height="101.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="198.5" y="909.2109"/><rect fill="#FFFFFF" filter="url(#fm0ptrzyw4b7r)" height="28" style="stroke:#A80036;stroke-width:1.0;" width="10" x="203.5" y="946.3438"/><rect fill="#FFFFFF" filter="url(#fm0ptrzyw4b7r)" height="2209.1563" style="stroke:#A80036;stroke-width:1.0;" width="10" x="352.5" y="199.3594"/><rect fill="#FFFFFF" filter="url(#fm0ptrzyw4b7r)" height="28" style="stroke:#A80036;stroke-width:1.0;" width="10" x="357.5" y="349.1563"/><rect fill="#FFFFFF" filter="url(#fm0ptrzyw4b7r)" height="28" style="stroke:#A80036;stroke-width:1.0;" width="10" x="357.5" y="436.4219"/><rect fill="#FFFFFF" filter="url(#fm0ptrzyw4b7r)" height="826.25" style="stroke:#A80036;stroke-width:1.0;" width="10" x="726.5" y="628.6172"/><rect fill="#FFFFFF" filter="url(#fm0ptrzyw4b7r)" height="44.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="862" y="228.4922"/><rect fill="#FFFFFF" filter="url(#fm0ptrzyw4b7r)" height="204.9297" style="stroke:#A80036;stroke-width:1.0;" width="10" x="862" y="2174.4531"/><rect fill="#FFFFFF" filter="url(#fm0ptrzyw4b7r)" height="28" style="stroke:#A80036;stroke-width:1.0;" width="10" x="867" y="2315.25"/><rect fill="#FFFFFF" filter="url(#fm0ptrzyw4b7r)" height="101.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1193" y="778.8125"/><rect fill="#FFFFFF" filter="url(#fm0ptrzyw4b7r)" height="28" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1198" y="815.9453"/><rect fill="#FFFFFF" filter="url(#fm0ptrzyw4b7r)" height="280.1953" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1193" y="1085.0078"/><rect fill="#FFFFFF" filter="url(#fm0ptrzyw4b7r)" height="28" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1198" y="1161.4063"/><rect fill="#FFFFFF" filter="url(#fm0ptrzyw4b7r)" height="28" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1198" y="1240.5391"/><rect fill="#FFFFFF" filter="url(#fm0ptrzyw4b7r)" height="469.8594" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1193" y="1630.0625"/><rect fill="#FFFFFF" filter="url(#fm0ptrzyw4b7r)" height="28" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1198" y="1667.1953"/><rect fill="#FFFFFF" filter="url(#fm0ptrzyw4b7r)" height="28" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1198" y="1793.7266"/><rect fill="#FFFFFF" filter="url(#fm0ptrzyw4b7r)" height="28" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1198" y="1896.125"/><rect fill="#FFFFFF" filter="url(#fm0ptrzyw4b7r)" height="28" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1198" y="1975.2578"/><rect fill="#FFFFFF" filter="url(#fm0ptrzyw4b7r)" height="29.1328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1193" y="2248.9844"/><polygon fill="#A80036" points="340.5,195.3594,350.5,199.3594,340.5,203.3594,344.5,199.3594" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="203.5" x2="346.5" y1="199.3594" y2="199.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="210.5" y="194.2935">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106" x="223.5" y="194.2935">Click on Connect</text><polygon fill="#A80036" points="850,224.4922,860,228.4922,850,232.4922,854,228.4922" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="362.5" x2="856" y1="228.4922" y2="228.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="369.5" y="223.4263">2</text><text fill="#A52A2A" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="258" x="382.5" y="223.4263">http://ResourceServer.com/Emails</text><polygon fill="#A80036" points="373.5,268.7578,363.5,272.7578,373.5,276.7578,369.5,272.7578" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="367.5" x2="866" y1="272.7578" y2="272.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8" x="379.5" y="260.1255">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="61" x="391.5" y="252.5591">HTTP 302</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="70" x="391.5" y="267.6919">Redirect to</text><text fill="#0000FF" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="85" x="465.5" y="267.6919">AuthServer</text><path d="M309,287.7578 L393,287.7578 L393,294.7578 L383,304.7578 L309,304.7578 L309,287.7578 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="191.6641" style="stroke:#000000;stroke-width:2.0;" width="305.5" x="309" y="287.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="39" x="324" y="300.8247">PKCE</text><line style="stroke:#A80036;stroke-width:1.0;" x1="367.5" x2="409.5" y1="341.1563" y2="341.1563"/><line style="stroke:#A80036;stroke-width:1.0;" x1="409.5" x2="409.5" y1="341.1563" y2="354.1563"/><line style="stroke:#A80036;stroke-width:1.0;" x1="368.5" x2="409.5" y1="354.1563" y2="354.1563"/><polygon fill="#A80036" points="378.5,350.1563,368.5,354.1563,378.5,358.1563,374.5,354.1563" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="374.5" y="328.5239">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="58" x="387.5" y="320.9575">generate</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="98" x="449.5" y="320.9575">code_verifier</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="5" x="387.5" y="336.0903">(</text><text fill="#8B4513" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="94" x="392.5" y="336.0903">FED1234FAD</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="5" x="486.5" y="336.0903">)</text><line style="stroke:#A80036;stroke-width:1.0;" x1="367.5" x2="409.5" y1="428.4219" y2="428.4219"/><line style="stroke:#A80036;stroke-width:1.0;" x1="409.5" x2="409.5" y1="428.4219" y2="441.4219"/><line style="stroke:#A80036;stroke-width:1.0;" x1="368.5" x2="409.5" y1="441.4219" y2="441.4219"/><polygon fill="#A80036" points="378.5,437.4219,368.5,441.4219,378.5,445.4219,374.5,441.4219" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="374.5" y="415.7896">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="58" x="387.5" y="408.2231">generate</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="113" x="449.5" y="408.2231">code_challenge</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="36" x="566.5" y="408.2231">string</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="5" x="387.5" y="423.356">(</text><text fill="#FF4500" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="150" x="392.5" y="423.356">CBAD1241232191AB</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="5" x="542.5" y="423.356">)</text><polygon fill="#A80036" points="714.5,624.6172,724.5,628.6172,714.5,632.6172,718.5,628.6172" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="362.5" x2="720.5" y1="628.6172" y2="628.6172"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="369.5" y="563.02">6</text><text fill="#0000FF" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="250" x="382.5" y="502.4888">http://AuthServer.com/Authorize</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52" x="382.5" y="517.6216">Method:</text><text fill="#008000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="31" x="438.5" y="517.6216">GET</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="9" x="382.5" y="532.7544">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="57" x="398.5" y="547.8872">client_id:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="115" x="459.5" y="547.8872">DEADFACE0123</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="574.5" y="547.8872">,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="161" x="398.5" y="563.02">code_challenge_method:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="35" x="563.5" y="563.02">plain</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="598.5" y="563.02">,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="104" x="398.5" y="578.1528">code_challenge:</text><text fill="#FF4500" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="150" x="506.5" y="578.1528">CBAD1241232191AB</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="656.5" y="578.1528">,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100" x="398.5" y="593.2856">response_type:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="41" x="502.5" y="593.2856">CODE</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="543.5" y="593.2856">,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="77" x="398.5" y="608.4185">redirect_uri:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="235" x="479.5" y="608.4185">http://MyApp.com.app/CallBack</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="9" x="382.5" y="623.5513">}</text><path d="M5,539.3867 L5,579.3867 L344,579.3867 L344,549.3867 L334,539.3867 L5,539.3867 " fill="#FBFB77" filter="url(#fm0ptrzyw4b7r)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M334,539.3867 L334,549.3867 L344,549.3867 L334,539.3867 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="179" x="11" y="556.4536">code_challenge_method</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="96" x="190" y="556.4536">: plain or S256,</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="88" x="11" y="571.5864">redirect_uri</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="230" x="99" y="571.5864">: mobile os specific custom scheme</text><polygon fill="#A80036" points="1181,774.8125,1191,778.8125,1181,782.8125,1185,778.8125" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="736.5" x2="1187" y1="778.8125" y2="778.8125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="743.5" y="713.2153">7</text><text fill="#0000FF" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="250" x="756.5" y="652.6841">http://AuthServer.com/Authorize</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52" x="756.5" y="667.8169">Method:</text><text fill="#008000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="31" x="812.5" y="667.8169">GET</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="9" x="756.5" y="682.9497">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="57" x="772.5" y="698.0825">client_id:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="115" x="833.5" y="698.0825">DEADFACE0123</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="948.5" y="698.0825">,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="161" x="772.5" y="713.2153">code_challenge_method:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="35" x="937.5" y="713.2153">plain</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="972.5" y="713.2153">,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="104" x="772.5" y="728.3481">code_challenge:</text><text fill="#FF4500" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="150" x="880.5" y="728.3481">CBAD1241232191AB</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="1030.5" y="728.3481">,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100" x="772.5" y="743.481">response_type:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="41" x="876.5" y="743.481">CODE</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="917.5" y="743.481">,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="77" x="772.5" y="758.6138">redirect_uri:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="235" x="853.5" y="758.6138">http://MyApp.com.app/CallBack</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="9" x="756.5" y="773.7466">}</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1208" x2="1250" y1="807.9453" y2="807.9453"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1250" x2="1250" y1="807.9453" y2="820.9453"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1209" x2="1250" y1="820.9453" y2="820.9453"/><polygon fill="#A80036" points="1219,816.9453,1209,820.9453,1219,824.9453,1215,820.9453" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="1215" y="802.8794">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="121" x="1228" y="802.8794">Render Login Form</text><polygon fill="#A80036" points="747.5,876.0781,737.5,880.0781,747.5,884.0781,743.5,880.0781" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="741.5" x2="1197" y1="880.0781" y2="880.0781"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="753.5" y="875.0122">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="71" x="766.5" y="875.0122">Login Form</text><polygon fill="#A80036" points="219.5,905.2109,209.5,909.2109,219.5,913.2109,215.5,909.2109" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="213.5" x2="725.5" y1="909.2109" y2="909.2109"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="225.5" y="904.145">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="71" x="248.5" y="904.145">Login Form</text><line style="stroke:#A80036;stroke-width:1.0;" x1="213.5" x2="255.5" y1="938.3438" y2="938.3438"/><line style="stroke:#A80036;stroke-width:1.0;" x1="255.5" x2="255.5" y1="938.3438" y2="951.3438"/><line style="stroke:#A80036;stroke-width:1.0;" x1="214.5" x2="255.5" y1="951.3438" y2="951.3438"/><polygon fill="#A80036" points="224.5,947.3438,214.5,951.3438,224.5,955.3438,220.5,951.3438" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="220.5" y="933.2778">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="108" x="242.5" y="933.2778">Input Credentials</text><polygon fill="#A80036" points="714.5,1006.4766,724.5,1010.4766,714.5,1014.4766,718.5,1010.4766" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="203.5" x2="720.5" y1="1010.4766" y2="1010.4766"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="210.5" y="1005.4106">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="82" x="232.5" y="1005.4106">Submit Form</text><polygon fill="#A80036" points="1181,1081.0078,1191,1085.0078,1181,1089.0078,1185,1085.0078" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="736.5" x2="1187" y1="1085.0078" y2="1085.0078"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17" x="743.5" y="1057.2427">13</text><text fill="#0000FF" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="250" x="764.5" y="1034.5435">http://AuthServer.com/Authorize</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="1018.5" y="1034.5435"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="9" x="764.5" y="1049.6763">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="70" x="780.5" y="1064.8091">credentials</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="9" x="764.5" y="1079.9419">}</text><path d="M1096.5,1100.0078 L1180.5,1100.0078 L1180.5,1107.0078 L1170.5,1117.0078 L1096.5,1117.0078 L1096.5,1100.0078 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="104.3984" style="stroke:#000000;stroke-width:2.0;" width="460.5" x="1096.5" y="1100.0078"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="39" x="1111.5" y="1113.0747">PKCE</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1208" x2="1250" y1="1153.4063" y2="1153.4063"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1250" x2="1250" y1="1153.4063" y2="1166.4063"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1209" x2="1250" y1="1166.4063" y2="1166.4063"/><polygon fill="#A80036" points="1219,1162.4063,1209,1166.4063,1219,1170.4063,1215,1166.4063" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1215" y="1140.7739">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="149" x="1237" y="1133.2075">Store code_challenge*(</text><text fill="#FF4500" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="150" x="1386" y="1133.2075">CBAD1241232191AB</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="9" x="1536" y="1133.2075">),</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="161" x="1237" y="1148.3403">code_challenge_method(</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="35" x="1398" y="1148.3403">plain</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="5" x="1433" y="1148.3403">)</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1208" x2="1250" y1="1232.5391" y2="1232.5391"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1250" x2="1250" y1="1232.5391" y2="1245.5391"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1209" x2="1250" y1="1245.5391" y2="1245.5391"/><polygon fill="#A80036" points="1219,1241.5391,1209,1245.5391,1219,1249.5391,1215,1245.5391" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1215" y="1227.4731">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="181" x="1237" y="1227.4731">generate authorization code</text><polygon fill="#A80036" points="747.5,1361.2031,737.5,1365.2031,747.5,1369.2031,743.5,1365.2031" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="741.5" x2="1197" y1="1365.2031" y2="1365.2031"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="753.5" y="1329.8716">16</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="43" x="775.5" y="1299.606">HTTP</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98" x="822.5" y="1299.606">302 Redirect to</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="235" x="924.5" y="1299.606">http://MyApp.com.app/CallBack</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52" x="775.5" y="1314.7388">Method:</text><text fill="#008000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="31" x="831.5" y="1314.7388">GET</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="9" x="775.5" y="1329.8716">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="791.5" y="1345.0044">CODE :</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="112" x="841.5" y="1345.0044">9807023480AC</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="9" x="775.5" y="1360.1372">}</text><polygon fill="#A80036" points="373.5,1450.8672,363.5,1454.8672,373.5,1458.8672,369.5,1454.8672" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="367.5" x2="730.5" y1="1454.8672" y2="1454.8672"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="379.5" y="1419.5356">17</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="235" x="401.5" y="1389.27">http://MyApp.com.app/CallBack</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52" x="401.5" y="1404.4028">Method:</text><text fill="#008000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="31" x="457.5" y="1404.4028">GET</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="9" x="401.5" y="1419.5356">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="417.5" y="1434.6685">CODE :</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="112" x="467.5" y="1434.6685">9807023480AC</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="9" x="401.5" y="1449.8013">}</text><polygon fill="#A80036" points="1181,1626.0625,1191,1630.0625,1181,1634.0625,1185,1630.0625" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="362.5" x2="1187" y1="1630.0625" y2="1630.0625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="369.5" y="1564.4653">18</text><text fill="#0000FF" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="232" x="391.5" y="1503.9341">http://AuthServer.com/Tokens</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52" x="391.5" y="1519.0669">Method:</text><text fill="#008000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="41" x="447.5" y="1519.0669">POST</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="9" x="391.5" y="1534.1997">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="36" x="407.5" y="1549.3325">code:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="112" x="447.5" y="1549.3325">9807023480AC</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="559.5" y="1549.3325">,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="57" x="407.5" y="1564.4653">client_id:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="115" x="468.5" y="1564.4653">DEADFACE0123</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="583.5" y="1564.4653">,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="407.5" y="1579.5981">code_verifier:</text><text fill="#8B4513" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="94" x="499.5" y="1579.5981">FED1234FAD</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="593.5" y="1579.5981">,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="75" x="407.5" y="1594.731">grant_type:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="174" x="486.5" y="1594.731">AUTHORIZATION_CODE</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="660.5" y="1594.731">,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="77" x="407.5" y="1609.8638">redirect_uri:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="235" x="488.5" y="1609.8638">http://MyApp.com.app/CallBack</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="9" x="391.5" y="1624.9966">}</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1208" x2="1250" y1="1659.1953" y2="1659.1953"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1250" x2="1250" y1="1659.1953" y2="1672.1953"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1209" x2="1250" y1="1672.1953" y2="1672.1953"/><polygon fill="#A80036" points="1219,1668.1953,1209,1672.1953,1219,1676.1953,1215,1672.1953" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1215" y="1654.1294">19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="182" x="1237" y="1654.1294">validate auth_code, client_id</text><path d="M1096.5,1717.1953 L1180.5,1717.1953 L1180.5,1724.1953 L1170.5,1734.1953 L1096.5,1734.1953 L1096.5,1717.1953 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="221.9297" style="stroke:#000000;stroke-width:2.0;" width="418.5" x="1096.5" y="1717.1953"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="39" x="1111.5" y="1730.2622">PKCE</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1208" x2="1250" y1="1785.7266" y2="1785.7266"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1250" x2="1250" y1="1785.7266" y2="1798.7266"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1209" x2="1250" y1="1798.7266" y2="1798.7266"/><polygon fill="#A80036" points="1219,1794.7266,1209,1798.7266,1219,1802.7266,1215,1798.7266" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="1215" y="1765.5278">20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="194" x="1238" y="1750.395">calculate new_code_challenge</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="31" x="1238" y="1765.5278">from</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="98" x="1273" y="1765.5278">code_verifier</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="79" x="1375" y="1765.5278">using stored</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="179" x="1238" y="1780.6606">code_challenge_method</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="1417" y="1780.6606">.</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1208" x2="1250" y1="1888.125" y2="1888.125"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1250" x2="1250" y1="1888.125" y2="1901.125"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1209" x2="1250" y1="1901.125" y2="1901.125"/><polygon fill="#A80036" points="1219,1897.125,1209,1901.125,1219,1905.125,1215,1901.125" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1215" y="1867.9263">21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52" x="1237" y="1852.7935">Validate</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="150" x="1293" y="1852.7935">new_code_challenge</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="56" x="1447" y="1852.7935">matches</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="58" x="1237" y="1867.9263">the store</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="113" x="1299" y="1867.9263">code_challenge</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="64" x="1412" y="1867.9263">, from the</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="113" x="1237" y="1883.0591">authorization call.</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1208" x2="1250" y1="1967.2578" y2="1967.2578"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1250" x2="1250" y1="1967.2578" y2="1980.2578"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1209" x2="1250" y1="1980.2578" y2="1980.2578"/><polygon fill="#A80036" points="1219,1976.2578,1209,1980.2578,1219,1984.2578,1215,1980.2578" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1215" y="1962.1919">22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="105" x="1237" y="1962.1919">generate tokens</text><polygon fill="#A80036" points="373.5,2095.9219,363.5,2099.9219,373.5,2103.9219,369.5,2099.9219" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="367.5" x2="1197" y1="2099.9219" y2="2099.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17" x="379.5" y="2064.5903">23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="9" x="400.5" y="2034.3247">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="92" x="416.5" y="2049.4575">access_token:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="164" x="512.5" y="2049.4575">DGF3DS90124FADS0U</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="676.5" y="2049.4575">,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="94" x="416.5" y="2064.5903">refresh_token:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="146" x="514.5" y="2064.5903">FGLAHG810324GAG</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="660.5" y="2064.5903">,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="77" x="416.5" y="2079.7231">token_type:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="58" x="497.5" y="2079.7231">BEARER</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="559.5" y="2079.7231"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="9" x="400.5" y="2094.856">}</text><polygon fill="#A80036" points="850,2170.4531,860,2174.4531,850,2178.4531,854,2174.4531" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="362.5" x2="856" y1="2174.4531" y2="2174.4531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="369.5" y="2146.688">24</text><text fill="#A52A2A" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="258" x="391.5" y="2123.9888">http://ResourceServer.com/Emails</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="653.5" y="2123.9888"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="9" x="391.5" y="2139.1216">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="92" x="407.5" y="2154.2544">access_token:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="164" x="503.5" y="2154.2544">DGF3DS90124FADS0U</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="9" x="391.5" y="2169.3872">}</text><polygon fill="#A80036" points="1181,2244.9844,1191,2248.9844,1181,2252.9844,1185,2248.9844" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="872" x2="1187" y1="2248.9844" y2="2248.9844"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="879" y="2221.2192">25</text><text fill="#0000FF" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="238" x="901" y="2198.52">http://AuthServer.com/Validate</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="1143" y="2198.52"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="9" x="901" y="2213.6528">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="92" x="917" y="2228.7856">access_token:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="164" x="1013" y="2228.7856">DGF3DS90124FADS0U</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="1181" y="2228.7856"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="9" x="901" y="2243.9185">}</text><polygon fill="#A80036" points="883,2274.1172,873,2278.1172,883,2282.1172,879,2278.1172" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="877" x2="1197" y1="2278.1172" y2="2278.1172"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="889" y="2273.0513">26</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52" x="911" y="2273.0513">Success</text><line style="stroke:#A80036;stroke-width:1.0;" x1="877" x2="919" y1="2307.25" y2="2307.25"/><line style="stroke:#A80036;stroke-width:1.0;" x1="919" x2="919" y1="2307.25" y2="2320.25"/><line style="stroke:#A80036;stroke-width:1.0;" x1="878" x2="919" y1="2320.25" y2="2320.25"/><polygon fill="#A80036" points="888,2316.25,878,2320.25,888,2324.25,884,2320.25" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="884" y="2302.1841">27</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="147" x="906" y="2302.1841">prepare email_payload</text><polygon fill="#A80036" points="373.5,2375.3828,363.5,2379.3828,373.5,2383.3828,369.5,2379.3828" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="367.5" x2="866" y1="2379.3828" y2="2379.3828"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="379.5" y="2374.3169">28</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="93" x="401.5" y="2374.3169">email_payload</text><polygon fill="#A80036" points="214.5,2404.5156,204.5,2408.5156,214.5,2412.5156,210.5,2408.5156" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="208.5" x2="356.5" y1="2408.5156" y2="2408.5156"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="220.5" y="2403.4497">29</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="42" x="242.5" y="2403.4497">emails</text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="47" x="1421" y="14.2822">Created:</text><text fill="#FF0000" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="96" x="1471" y="14.2822">Jun-22-2021 00:20</text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacing" textLength="187" x="1380" y="25.9229">View Generated: Jul-11-2021 01:41</text><!--MD5=[ced1c28cbf37dcbddb41a0249facc5b4]
@startuml
header
    Created: <font color=red>Jun-22-2021 00:20</font>
    View Generated: %date("MMM-dd-yyyy HH:mm")
endheader
title
    = [oauth 2.0] Authorization Code Grant with PKCE flow (app to server)
    <size:11><i> User wants to authorize email client to read emails</i></size>
    <size:11><i> from the email servers (i.e., resource servers) </i></size>
end title
autoactivate on 

participant "User" as user <<Resource Owner>>
box Client App & embedded UA #MOTIVATION
    participant "App" as app <<Client>> #IMPLEMENTATION
    participant "User Agent" as ua #IMPLEMENTATION
end box
participant "GMail Server" as resourceServer <<Resource Server>> #TECHNOLOGY
participant "Google Account Server" as authServer <<Authorization Server>> #TECHNOLOGY

autonumber
user -> app : Click on Connect
    app -> resourceServer : <font color=brown>**http://ResourceServer.com/Emails**</font>
    resourceServer - -> app : HTTP 302\nRedirect to <font color=blue>**AuthServer**</font>

    group #BUSINESS PKCE
        app -> app : generate **code_verifier**\n(<font color=saddlebrown>**FED1234FAD**</font>)
        deactivate app
        app -> app : generate **code_challenge** string\n(<font color=orangered>**CBAD1241232191AB**</font>)
        deactivate app
    end group
    app -> ua : <font color=blue>**http://AuthServer.com/Authorize**</font>\nMethod: <font color=green>**GET**</font>\n{\n    client_id: **DEADFACE0123**,\n    code_challenge_method: **plain**,\n    code_challenge: <font color=orangered>**CBAD1241232191AB**</font>,\n    response_type: **CODE**,\n    redirect_uri: <font color=red>**http://MyApp.com.app/CallBack**</font>\n}
    note left
    **code_challenge_method**: plain or S256,
    **redirect_uri**: mobile os specific custom scheme
    end note
        ua -> authServer : <font color=blue>**http://AuthServer.com/Authorize**</font>\nMethod: <font color=green>**GET**</font>\n{\n    client_id: **DEADFACE0123**,\n    code_challenge_method: **plain**,\n    code_challenge: <font color=orangered>**CBAD1241232191AB**</font>,\n    response_type: **CODE**,\n    redirect_uri: <font color=red>**http://MyApp.com.app/CallBack**</font>\n}
            authServer -> authServer : Render Login Form
            deactivate authServer
        authServer - -> ua : Login Form
    
        ua -> user : Login Form
            user -> user : Input Credentials
            deactivate user
        user - -> ua : Submit Form
    
        ua -> authServer : <font color=blue>**http://AuthServer.com/Authorize**</font> \n{\n    credentials \n}
            group #BUSINESS PKCE
                authServer -> authServer : Store code_challenge*(<font color=orangered>**CBAD1241232191AB**</font>),\ncode_challenge_method(**plain**)
                deactivate authServer
            end group
            authServer -> authServer : generate authorization code
            deactivate authServer
        authServer - -> ua : **HTTP** 302 Redirect to <font color=red>**http://MyApp.com.app/CallBack**</font>\nMethod: <font color=green>**GET**</font>\n{\n    CODE : **9807023480AC**\n}
    ua - -> app : <font color=red>**http://MyApp.com.app/CallBack**</font>\nMethod: <font color=green>**GET**</font>\n{\n    CODE : **9807023480AC**\n}

    |||
    app -> authServer : <font color=blue>**http://AuthServer.com/Tokens**</font>\nMethod: <font color=green>**POST**</font>\n{\n    code: **9807023480AC**,\n    client_id: **DEADFACE0123**,\n    code_verifier: <font color=saddlebrown>**FED1234FAD**</font>,\n    grant_type: **AUTHORIZATION_CODE**,\n    redirect_uri: <font color=red>**http://MyApp.com.app/CallBack**</font>\n}
        authServer -> authServer : validate auth_code, client_id
        deactivate authServer
        group #BUSINESS PKCE
            authServer -> authServer : calculate new_code_challenge\nfrom **code_verifier** using stored\n**code_challenge_method**.
            deactivate authServer
            authServer -> authServer : Validate **new_code_challenge** matches\nthe store **code_challenge**, from the\nauthorization call.
            deactivate authServer
        end group
        authServer -> authServer : generate tokens
        deactivate authServer
    authServer - -> app : {\n    access_token: **DGF3DS90124FADS0U**,\n    refresh_token: **FGLAHG810324GAG**,\n    token_type: **BEARER** \n}
    'ua - -> app : {\n    access_token: **DGF3DS90124FADS0U**,\n    refresh_token: **FGLAHG810324GAG**,\n    token_type: **BEARER** \n}

    app -> resourceServer : <font color=brown>**http://ResourceServer.com/Emails**</font> \n{\n    access_token: **DGF3DS90124FADS0U**\n}
        resourceServer -> authServer : <font color=blue>**http://AuthServer.com/Validate**</font> \n{\n    access_token: **DGF3DS90124FADS0U** \n}
        authServer - -> resourceServer : Success
        resourceServer -> resourceServer : prepare email_payload
        deactivate resourceServer
    resourceServer - -> app : email_payload
app - -> user : emails
@enduml

@startuml
header
    Created: <font color=red>Jun-22-2021 00:20</font>
    View Generated: Jul-11-2021 01:41
endheader
title
    = [oauth 2.0] Authorization Code Grant with PKCE flow (app to server)
    <size:11><i> User wants to authorize email client to read emails</i></size>
    <size:11><i> from the email servers (i.e., resource servers) </i></size>
end title
autoactivate on 

participant "User" as user <<Resource Owner>>
box Client App & embedded UA #MOTIVATION
    participant "App" as app <<Client>> #IMPLEMENTATION
    participant "User Agent" as ua #IMPLEMENTATION
end box
participant "GMail Server" as resourceServer <<Resource Server>> #TECHNOLOGY
participant "Google Account Server" as authServer <<Authorization Server>> #TECHNOLOGY

autonumber
user -> app : Click on Connect
    app -> resourceServer : <font color=brown>**http://ResourceServer.com/Emails**</font>
    resourceServer - -> app : HTTP 302\nRedirect to <font color=blue>**AuthServer**</font>

    group #BUSINESS PKCE
        app -> app : generate **code_verifier**\n(<font color=saddlebrown>**FED1234FAD**</font>)
        deactivate app
        app -> app : generate **code_challenge** string\n(<font color=orangered>**CBAD1241232191AB**</font>)
        deactivate app
    end group
    app -> ua : <font color=blue>**http://AuthServer.com/Authorize**</font>\nMethod: <font color=green>**GET**</font>\n{\n    client_id: **DEADFACE0123**,\n    code_challenge_method: **plain**,\n    code_challenge: <font color=orangered>**CBAD1241232191AB**</font>,\n    response_type: **CODE**,\n    redirect_uri: <font color=red>**http://MyApp.com.app/CallBack**</font>\n}
    note left
    **code_challenge_method**: plain or S256,
    **redirect_uri**: mobile os specific custom scheme
    end note
        ua -> authServer : <font color=blue>**http://AuthServer.com/Authorize**</font>\nMethod: <font color=green>**GET**</font>\n{\n    client_id: **DEADFACE0123**,\n    code_challenge_method: **plain**,\n    code_challenge: <font color=orangered>**CBAD1241232191AB**</font>,\n    response_type: **CODE**,\n    redirect_uri: <font color=red>**http://MyApp.com.app/CallBack**</font>\n}
            authServer -> authServer : Render Login Form
            deactivate authServer
        authServer - -> ua : Login Form
    
        ua -> user : Login Form
            user -> user : Input Credentials
            deactivate user
        user - -> ua : Submit Form
    
        ua -> authServer : <font color=blue>**http://AuthServer.com/Authorize**</font> \n{\n    credentials \n}
            group #BUSINESS PKCE
                authServer -> authServer : Store code_challenge*(<font color=orangered>**CBAD1241232191AB**</font>),\ncode_challenge_method(**plain**)
                deactivate authServer
            end group
            authServer -> authServer : generate authorization code
            deactivate authServer
        authServer - -> ua : **HTTP** 302 Redirect to <font color=red>**http://MyApp.com.app/CallBack**</font>\nMethod: <font color=green>**GET**</font>\n{\n    CODE : **9807023480AC**\n}
    ua - -> app : <font color=red>**http://MyApp.com.app/CallBack**</font>\nMethod: <font color=green>**GET**</font>\n{\n    CODE : **9807023480AC**\n}

    |||
    app -> authServer : <font color=blue>**http://AuthServer.com/Tokens**</font>\nMethod: <font color=green>**POST**</font>\n{\n    code: **9807023480AC**,\n    client_id: **DEADFACE0123**,\n    code_verifier: <font color=saddlebrown>**FED1234FAD**</font>,\n    grant_type: **AUTHORIZATION_CODE**,\n    redirect_uri: <font color=red>**http://MyApp.com.app/CallBack**</font>\n}
        authServer -> authServer : validate auth_code, client_id
        deactivate authServer
        group #BUSINESS PKCE
            authServer -> authServer : calculate new_code_challenge\nfrom **code_verifier** using stored\n**code_challenge_method**.
            deactivate authServer
            authServer -> authServer : Validate **new_code_challenge** matches\nthe store **code_challenge**, from the\nauthorization call.
            deactivate authServer
        end group
        authServer -> authServer : generate tokens
        deactivate authServer
    authServer - -> app : {\n    access_token: **DGF3DS90124FADS0U**,\n    refresh_token: **FGLAHG810324GAG**,\n    token_type: **BEARER** \n}

    app -> resourceServer : <font color=brown>**http://ResourceServer.com/Emails**</font> \n{\n    access_token: **DGF3DS90124FADS0U**\n}
        resourceServer -> authServer : <font color=blue>**http://AuthServer.com/Validate**</font> \n{\n    access_token: **DGF3DS90124FADS0U** \n}
        authServer - -> resourceServer : Success
        resourceServer -> resourceServer : prepare email_payload
        deactivate resourceServer
    resourceServer - -> app : email_payload
app - -> user : emails
@enduml

PlantUML version 1.2021.9beta2(Unknown compile time)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>